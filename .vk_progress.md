# Parallel Setup Script Feature - Progress

## Status: In Progress (Session 1 Complete)

## Plan Reference
`/home/david/.claude/plans/mighty-wobbling-spring.md`

## Feature Summary
Add a `parallel_setup_script` boolean flag that allows setup scripts to run **concurrently** with the coding agent instead of waiting for setup to complete first. This is useful for long-running setup processes (like `npm install`) that don't need to complete before the agent starts working.

## Session 1: Database & Model Layer - COMPLETE

### Completed Items

- [x] **Sync with origin/main** - Already up to date
- [x] **Create migration** - `crates/db/migrations/20251218000000_add_parallel_setup_script.sql`
  ```sql
  ALTER TABLE projects ADD COLUMN parallel_setup_script BOOLEAN NOT NULL DEFAULT 0;
  ```
- [x] **Update `Project` struct** - Added `parallel_setup_script: bool` field
- [x] **Update `UpdateProject` struct** - Added `parallel_setup_script: Option<bool>` field
- [x] **Update all SQL queries** - Updated 12 queries in `project.rs`:
  - `find_all`
  - `find_most_active`
  - `find_by_id`
  - `find_by_remote_project_id`
  - `find_by_git_repo_path`
  - `find_by_git_repo_path_excluding_id`
  - `create`
  - `update`
  - `find_remote_projects`
  - `find_local_projects`
  - `upsert_remote_project`
  - `find_local_projects_with_last_attempt`
- [x] **Update API route handler** - Updated `projects.rs` to handle new field in update
- [x] **Verify cargo check passes** - PASS with DATABASE_URL
- [x] **Run npm run generate-types** - PASS
- [x] **Verify types in shared/types.ts** - PASS
  - `Project` type includes `parallel_setup_script: boolean`
  - `UpdateProject` type includes `parallel_setup_script: boolean | null`

### Files Modified

**Database:**
- `crates/db/migrations/20251218000000_add_parallel_setup_script.sql` (NEW)

**Backend:**
- `crates/db/src/models/project.rs` - Added field to structs, updated 12 SQL queries
- `crates/server/src/routes/projects.rs` - Updated update handler

**Shared:**
- `shared/types.ts` - Auto-generated with new field

### Technical Notes

- Used `parallel_setup_script as "parallel_setup_script!: bool"` type annotation in SQLx queries
- Default value is `false` (0 in SQLite) to preserve existing behavior
- Remote projects also get this field with default `false` via `upsert_remote_project`

## Session 2: Container Service Logic (Pending)

Scope:
- Update `start_attempt()` in `crates/services/src/services/container.rs`
- Update `should_finalize()` method
- Verify cargo check passes
- Manual test: Sequential mode still works

## Session 3: API & Frontend (Pending)

Scope:
- Update `crates/server/src/routes/projects.rs` update handler (already done in Session 1)
- Add checkbox to `frontend/src/pages/settings/ProjectSettings.tsx`
- Add i18n strings to all locale files (en, ja, ko, es)
- Verify npm run lint passes
- Verify npm run check passes
- Manual test: Full end-to-end flow
