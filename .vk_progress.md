# Swarm Implementation - Remote Task Attempt Operations

## Current Status: **in-progress**

## Overview
Implementing Steps 1-2 of the swarm remote task attempt operations feature.

## Completed Items

### Step 1: RemoteTaskAttemptContext
- [x] Added `RemoteTaskAttemptContext` struct to `crates/server/src/middleware/model_loaders.rs` (lines 68-94)
- [x] Added `is_available()` and `node_url()` helper methods matching `RemoteProjectContext` pattern

### Step 2: Modified load_task_attempt_impl
- [x] Enhanced middleware to load parent Task and Project
- [x] Injects `RemoteTaskAttemptContext` when project is remote
- [x] Uses `shared_task_id` for cross-node routing

### Step 3: check_remote_task_attempt_proxy helper
- [x] Added helper function in `crates/server/src/routes/task_attempts.rs` (lines 62-90)
- [x] Returns `(node_url, node_id, task_id)` tuple when remote and online
- [x] Returns `ApiError::BadGateway` when node offline or no URL
- [x] Added 4 unit tests for the helper

## Remaining Work
- [ ] Step 3: Add by-task-id routes (middleware + route registration)
- [ ] Step 4: Add proxy logic to core handlers
- [ ] Step 5: Add remote attempt start (backend + frontend)
- [ ] Step 6: Add remote diff streaming (frontend)
- [ ] Step 7: Add connection status badge (frontend)

## Files Modified
| File | Changes |
|------|---------|
| `crates/server/src/middleware/model_loaders.rs` | Added `RemoteTaskAttemptContext`, enhanced `load_task_attempt_impl` |
| `crates/server/src/routes/task_attempts.rs` | Added `check_remote_task_attempt_proxy` helper and unit tests |

## Build Status
- [x] `npm run check` passing
- [x] Backend compiles with warning about unused function (expected until Step 4)
- [x] Unit tests passing (4 tests)

## Next Session Recommendations
1. **Step 3**: Add `load_task_attempt_by_task_id_middleware` and register by-task-id routes
2. **Step 4**: Add proxy logic to handlers starting with:
   - `follow_up`
   - `stop_task_attempt_execution`
   - `get_task_attempt_branch_status`
3. Continue with git, PR, file, and draft operations

## Architecture Notes
The implementation follows the established pattern from remote projects:
- `RemoteProjectContext` (model_loaders.rs:44-66) → `RemoteTaskAttemptContext`
- `check_remote_proxy` (projects.rs:52-77) → `check_remote_task_attempt_proxy`
- Middleware loads Task + Project to determine if remote context needed
