# Task Menu Updates - Progress

## Plan
`/home/david/.claude/plans/expressive-finding-swing.md`

## Current Status
**Session 4: COMPLETE**

## Session 4 - Add Icons to Menu Items

### Completed Items
- [x] Add Lucide icon imports to actions-dropdown.tsx
- [x] Add icons to each DropdownMenuItem with `className="mr-2 h-4 w-4"`
- [x] npm run check passes
- [x] Browser testing - Desktop (light mode)
- [x] Browser testing - Mobile (375x667 viewport, light mode)
- [x] Browser testing - Desktop (dark mode)
- [x] Browser testing - Mobile (375x667 viewport, dark mode)

### Icon Mapping Applied
| Menu Item | Icon |
|-----------|------|
| Open in IDE | ExternalLink |
| View processes | Activity |
| View related tasks | Link2 |
| Create attempt | Plus |
| Create subtask | GitBranch |
| Git actions | GitMerge |
| Edit branch | Tag |
| Reassign | UserPlus |
| Archive | Archive |
| Unarchive | ArchiveRestore |
| Edit | Pencil |
| Duplicate | Copy |
| Delete | Trash2 |

### Files Changed
1. `frontend/src/components/ui/actions-dropdown.tsx` - Added Lucide icon imports and icons to all menu items

### Testing Results
- **Desktop (Light)**: All icons display correctly with good contrast
- **Mobile (Light)**: All icons display correctly with good contrast
- **Desktop (Dark)**: All icons display correctly with good contrast
- **Mobile (Dark)**: All icons display correctly with good contrast
- **Console**: Only pre-existing WebSocket warnings (unrelated to changes)

### Screenshots
- `desktop-light-menu-icons.png` - Desktop light mode menu with icons
- `mobile-light-menu-icons.png` - Mobile light mode menu with icons
- `desktop-dark-menu-icons.png` - Desktop dark mode menu with icons
- `mobile-dark-menu-icons.png` - Mobile dark mode menu with icons

---

## Session 3 - Remove Translation Keys

### Completed Items
- [x] Remove actionsMenu.share from en/tasks.json
- [x] Remove actionsMenu.stopShare from en/tasks.json
- [x] Remove shareDialog.* keys from en/tasks.json
- [x] Remove stopShareDialog.* keys from en/tasks.json
- [x] Remove translation keys from ja/tasks.json
- [x] Remove translation keys from ko/tasks.json
- [x] Remove translation keys from es/tasks.json
- [x] npm run check passes
- [x] Browser testing - Desktop (light mode)
- [x] Browser testing - Mobile (375x667 viewport)
- [x] Browser testing - Desktop (dark mode)
- [x] Browser testing - Mobile (dark mode)

### Files Changed
1. `frontend/src/i18n/locales/en/tasks.json` - Removed share-related translation keys
2. `frontend/src/i18n/locales/ja/tasks.json` - Removed share-related translation keys
3. `frontend/src/i18n/locales/ko/tasks.json` - Removed share-related translation keys
4. `frontend/src/i18n/locales/es/tasks.json` - Removed share-related translation keys

### Testing Results
- **Desktop (Light)**: Menu displays correctly without Share/Stop share items
- **Mobile (375x667)**: Menu displays correctly without Share/Stop share items
- **Desktop (Dark)**: Menu displays correctly with good contrast
- **Mobile (Dark)**: Menu displays correctly with good contrast
- **Console**: Only pre-existing React Router warnings (unrelated to changes)

### Screenshots
- `desktop-light-menu.png` - Desktop light mode menu
- `mobile-light-menu.png` - Mobile light mode menu
- `desktop-dark-menu.png` - Desktop dark mode menu
- `mobile-dark-menu.png` - Mobile dark mode menu

---

## Session 2 - Remove Backend Share Endpoints

### Completed Items
- [x] Remove share_task handler and ShareTaskResponse from tasks.rs
- [x] Remove /share route from tasks router
- [x] Remove delete_shared_task handler from shared_tasks.rs
- [x] Remove DELETE route from shared_tasks router
- [x] Remove ShareTaskResponse from generate_types.rs
- [x] Add orphan cleanup function (clear_orphaned_shared_task_ids) in task.rs
- [x] Add orphan cleanup call on server startup in main.rs
- [x] cargo clippy passes
- [x] cargo test passes
- [x] Browser testing - Desktop (light mode)
- [x] Browser testing - Mobile (375x667 viewport)
- [x] Browser testing - Dark mode
- [x] Backend endpoint verification - POST /share returns 405
- [x] Backend endpoint verification - DELETE /shared-tasks returns 405

### Files Changed
1. `crates/server/src/routes/tasks.rs` - Removed share_task handler, ShareTaskResponse struct, /share route, and ShareError import
2. `crates/server/src/routes/shared_tasks.rs` - Removed delete_shared_task handler, DELETE route, and delete import
3. `crates/db/src/models/task.rs` - Added clear_orphaned_shared_task_ids function
4. `crates/server/src/main.rs` - Added orphan cleanup call on startup, added Task import
5. `crates/server/src/bin/generate_types.rs` - Removed ShareTaskResponse from type generation

### Testing Results
- **Endpoint Removal**: POST /api/projects/{id}/tasks/{id}/share returns 405 Method Not Allowed
- **Endpoint Removal**: DELETE /api/shared-tasks/{id} returns 405 Method Not Allowed
- **Desktop (Light)**: Menu displays correctly without Share/Stop share items
- **Mobile (375x667)**: Menu displays correctly without Share/Stop share items
- **Dark Mode**: Settings page and theme switching work correctly
- **Console**: Only pre-existing React DOM nesting warning (unrelated to changes)

---

## Session 1 - Remove Frontend Share UI

### Completed Items
- [x] Remove ShareDialog and StopShareTaskDialog imports from actions-dropdown.tsx
- [x] Remove handleShare and handleStopShare functions from actions-dropdown.tsx
- [x] Remove Share and Stop share menu items from actions-dropdown.tsx (2 occurrences)
- [x] Remove canStopShare variable from actions-dropdown.tsx
- [x] Remove shareTask and unshareSharedTask mutations from useTaskMutations.ts
- [x] Remove tasksApi.share() and tasksApi.unshare() methods from api.ts
- [x] Delete ShareDialog.tsx file
- [x] Delete StopShareTaskDialog.tsx file
- [x] Fix dialogs/index.ts exports (removed deleted file exports)
- [x] Fix types/modals.ts (removed ShareDialogProps and StopShareTaskDialogProps)
- [x] npm run check passes
- [x] Browser testing - Desktop (light mode)
- [x] Browser testing - Mobile (375x667 viewport)
- [x] Browser testing - Dark mode
- [x] Console logs verified - no errors related to share functionality

### Files Changed
1. `frontend/src/components/ui/actions-dropdown.tsx` - Removed share-related imports, handlers, menu items, and canStopShare variable
2. `frontend/src/hooks/useTaskMutations.ts` - Removed shareTask and unshareSharedTask mutations
3. `frontend/src/lib/api.ts` - Removed share() and unshare() methods, removed ShareTaskResponse import
4. `frontend/src/components/dialogs/index.ts` - Removed exports for deleted dialog files
5. `frontend/src/types/modals.ts` - Removed ShareDialogProps and StopShareTaskDialogProps from interface

### Files Deleted
1. `frontend/src/components/dialogs/tasks/ShareDialog.tsx`
2. `frontend/src/components/dialogs/tasks/StopShareTaskDialog.tsx`

### Testing Results
- **Desktop (Light)**: Menu displays correctly without Share/Stop share items
- **Mobile (375x667)**: Menu displays correctly without Share/Stop share items
- **Dark Mode**: Menu displays correctly without Share/Stop share items
- **Console**: Only pre-existing React Router warnings and WebSocket timing issues (unrelated to changes)

### Remaining Menu Items
After removal, the task menu contains:
- Reassign (disabled when no worktree)
- View related tasks
- Create subtask
- Archive
- Edit
- Duplicate
- Delete

## Remaining Work (Future Sessions)

### Sessions 5-6 - Mobile-First UX Improvements
- Session 5: Create useIsMobile hook for responsive detection
- Session 6: Implement mobile bottom sheet instead of dropdown on small screens
- See plan for details

## Next Session Recommendations
Sessions 1-4 are complete:
- Session 1: Frontend UI (removed Share/Stop share)
- Session 2: Backend endpoints (removed share endpoints)
- Session 3: Translation files (removed share translation keys)
- Session 4: Icons added to all menu items

Consider proceeding with Sessions 5-6 for mobile bottom sheet implementation.
