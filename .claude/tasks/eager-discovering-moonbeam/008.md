---
name: Add Disconnect Cleanup Logic
status: open
created: 2026-01-08T21:22:12Z
updated: 2026-01-08T21:22:12Z
depends_on: [007]
conflicts_with: [007]
---

# Task: Add Disconnect Cleanup Logic

## Description
When a node disconnects, clear all its pending backfill requests and reset those attempts to partial state so they can be retried.

## Acceptance Criteria
- [ ] In session `handle()` cleanup section, call `tracker.clear_node(node_id)`
- [ ] For each cleared attempt ID, call `repo.reset_attempt_to_partial(attempt_id)`
- [ ] Log count of cleared pending backfill requests
- [ ] Errors during reset are logged but don't prevent cleanup

## Technical Details
- Location: `crates/remote/src/nodes/ws/session.rs`
- Add cleanup code after the main message loop exits (in the disconnect/cleanup section)
- Use `NodeTaskAttemptRepository::new(&pool)` to get repo

## Dependencies
- [ ] Task 007 - Tracker must be available in session handle()

## Effort Estimate
- Size: S
- Hours: 0.5

## Definition of Done
- [ ] Disconnect cleanup implemented
- [ ] Cleared attempts reset to partial
- [ ] Appropriate logging added
- [ ] `cargo check -p remote` passes
- [ ] `cargo clippy -p remote -- -D warnings` passes
