---
name: Update handle_backfill_response with Tracking
status: open
created: 2026-01-08T21:22:12Z
updated: 2026-01-08T21:22:12Z
depends_on: [003, 004, 005]
conflicts_with: []
---

# Task: Update handle_backfill_response with Tracking

## Description
Update the backfill response handler to use the tracker to correlate responses with their original attempt IDs, then mark them complete or reset on failure.

## Acceptance Criteria
- [ ] Add `tracker: &BackfillRequestTracker` parameter to `handle_backfill_response()`
- [ ] Call `tracker.complete(response.request_id)` to get attempt IDs
- [ ] On success: call `repo.mark_complete(attempt_id)` for each attempt
- [ ] On failure: call `repo.reset_attempt_to_partial(attempt_id)` for each attempt
- [ ] Log appropriate warnings if tracker has no mapping for response
- [ ] Update call site in `handle_message()` to pass tracker

## Technical Details
- Location: `crates/remote/src/nodes/ws/session.rs`
- Function at lines 1421-1470 (approximately)
- Need to get tracker from state and pass to handler
- Use `NodeTaskAttemptRepository::new(pool)` to create repo instance

## Dependencies
- [ ] Task 003 - BackfillService must have tracker
- [ ] Task 004 - reset_attempt_to_partial must exist
- [ ] Task 005 - AppState must expose tracker

## Effort Estimate
- Size: M
- Hours: 2

## Definition of Done
- [ ] Handler updated with tracker parameter
- [ ] Success path marks attempts complete
- [ ] Failure path resets attempts to partial
- [ ] Logging is appropriate
- [ ] Call site updated
- [ ] `cargo check -p remote` passes
- [ ] `cargo clippy -p remote -- -D warnings` passes
