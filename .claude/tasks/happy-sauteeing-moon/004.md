---
name: Write test_reject_if_remote_returns_not_found
status: done
created: 2026-01-12T00:16:47Z
updated: 2026-01-12T11:35:00Z
depends_on: [001]
conflicts_with: [001, 002, 003]
---

# Task: Write test_reject_if_remote_returns_not_found

## Description
Write the third test case that verifies the `reject_if_remote` helper function correctly returns `NotFound` when the task_attempt references a non-existent task.

## Acceptance Criteria
- [x] Test `test_reject_if_remote_returns_not_found_for_missing_task` added to test module
- [x] Test creates a fake TaskAttempt struct with a non-existent task_id
- [x] Test verifies `reject_if_remote` returns `Err(ApiError::NotFound(_))`
- [x] Test FAILS to compile initially (function doesn't exist yet - RED phase)

## Technical Details
- Implementation approach: Create a TaskAttempt struct manually with a random UUID as task_id
- Key considerations:
  - Need to understand TaskAttempt struct fields to construct a valid instance
  - The fake attempt doesn't need to be in the database
- Code locations/files affected: `crates/server/src/routes/message_queue.rs` (tests module)

## Dependencies
- [x] Task 001 - test module structure must exist

## Effort Estimate
- Size: S
- Hours: 0.5

## Definition of Done
- [x] Test code written
- [x] Test fails to compile (expected - function doesn't exist yet)

## Implementation Notes
- Test creates a `TaskAttempt` struct manually with all required fields
- Uses `Uuid::new_v4()` for both `id` and `task_id` fields to ensure non-existent task
- Uses `chrono::Utc::now()` for timestamp fields
- Test verifies result matches `Err(ApiError::NotFound(_))` with "not found" message
