---
name: Write test_reject_if_remote_rejects_remote_project
status: done
created: 2026-01-12T00:16:47Z
updated: 2026-01-12T10:40:00Z
depends_on: [001]
conflicts_with: [001, 003]
---

# Task: Write test_reject_if_remote_rejects_remote_project

## Description
Write the first failing test case that verifies the `reject_if_remote` helper function correctly returns `BadRequest` when a task attempt belongs to a remote project (is_remote = true).

## Acceptance Criteria
- [x] Test `test_reject_if_remote_rejects_remote_project` added to test module
- [x] Test creates a remote project (is_remote = true, source_node_id set)
- [x] Test creates a task and task_attempt associated with the remote project
- [x] Test verifies `reject_if_remote` returns `Err(ApiError::BadRequest(_))`
- [x] Test FAILS to compile initially (function doesn't exist yet - RED phase)

## Technical Details
- Implementation approach: Use `create_test_pool()` to get isolated test database
- Key considerations:
  - Must insert project with `is_remote = true` and `source_node_id = Some(Uuid::new_v4())`
  - Must insert task and task_attempt with proper foreign keys
  - Use `sqlx::query!` macro for compile-time checked inserts
- Code locations/files affected: `crates/server/src/routes/message_queue.rs` (tests module)

## Dependencies
- [x] Task 001 - test module structure must exist

## Effort Estimate
- Size: S
- Hours: 0.5

## Definition of Done
- [x] Test code written
- [x] Test fails to compile (expected - function doesn't exist yet)

## Completion Notes
Test was added to `crates/server/src/routes/message_queue.rs` in the `tests` module.
Compilation fails with expected error:
```bash
error[E0425]: cannot find function `reject_if_remote` in this scope
   --> crates/server/src/routes/message_queue.rs:312:22
```
