---
name: Implement task cleanup function
status: completed
created: 2026-01-12T09:52:07Z
updated: 2026-01-13T15:42:00Z
depends_on: [005]
conflicts_with: []
---

# Task: Implement task cleanup function

## Description
Implement `clear_all_shared_task_ids_for_project()` function that clears all swarm sync references from tasks in a project.

## Acceptance Criteria
- [x] Function signature: `pub async fn clear_all_shared_task_ids_for_project(pool: &SqlitePool, project_id: Uuid) -> Result<u64, sqlx::Error>`
- [x] Updates tasks: SET `shared_task_id = NULL`, `remote_version = 0`, `remote_last_synced_at = NULL`
- [x] Only updates tasks WHERE `project_id = $1 AND shared_task_id IS NOT NULL`
- [x] Returns number of rows affected
- [x] Test from task 005 passes

## Technical Details
- Location: `crates/db/src/models/task/sync.rs`
- Use `sqlx::query!` with UPDATE statement
- Return `result.rows_affected()`

## Dependencies
- [x] Task 005 (test must exist first)

## Effort Estimate
- Size: XS
- Hours: 0.5

## Definition of Done
- [x] Function implemented
- [x] Code compiles
- [x] Test passes: `cargo test test_clear_all_shared_task_ids_for_project`
