---
name: Add archive validation for sync state
status: complete
created: 2026-01-12T09:52:07Z
updated: 2026-01-13T11:15:00Z
depends_on: [010]
conflicts_with: []
---

# Task: Add archive validation for sync state

## Description
Add validation to the archive task endpoint to detect and block archiving when sync state is broken (task has `shared_task_id` but project is unlinked).

## Acceptance Criteria
- [x] Validation logic in `crates/server/src/routes/tasks/handlers/status.rs`
- [x] Before archiving, check if task has `shared_task_id`
- [x] If yes, verify project has `remote_project_id`
- [x] If not linked, return `SyncStateBroken` error
- [x] Error message explains: "Project is unlinked from swarm. Please use 'Unlink & Reset' to clean up sync state"

## Technical Details
- Location: Archive handler in `crates/server/src/routes/tasks/handlers/status.rs`
- Fetch project to check `remote_project_id`
- Add check before calling Hive sync

## Dependencies
- [ ] Task 010 (SyncStateBroken error)

## Effort Estimate
- Size: S
- Hours: 0.75

## Definition of Done
- [x] Validation implemented
- [x] Code compiles
- [x] Test written and passes
- [ ] Manual test: archiving orphaned task returns clear error
