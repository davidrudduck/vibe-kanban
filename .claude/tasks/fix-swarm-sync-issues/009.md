---
name: Create unlink handler and register route
status: completed
created: 2026-01-12T09:52:07Z
updated: 2026-01-13T10:40:00Z
depends_on: [006, 007, 008]
conflicts_with: []
---

# Task: Create unlink handler and register route

## Description
Implement the unlink-from-swarm endpoint that clears all sync references from a project and its tasks.

## Acceptance Criteria
- [x] New file: `crates/server/src/routes/projects/handlers/swarm.rs`
- [x] Handler function: `unlink_from_swarm()`
- [x] Calls `clear_all_shared_task_ids_for_project()`
- [x] Calls `clear_hive_sync_for_project()`
- [x] Updates project: SET `remote_project_id = NULL`
- [x] Returns `UnlinkSwarmResponse` with counts
- [x] Route registered: `POST /api/projects/:id/unlink-swarm`

## Technical Details
- Handler signature: `pub async fn unlink_from_swarm(State(deployment): State<DeploymentImpl>, Path(id): Path<Uuid>, Json(req): Json<UnlinkSwarmRequest>) -> Result<ResponseJson<ApiResponse<UnlinkSwarmResponse>>, ApiError>`
- Export swarm module in `crates/server/src/routes/projects/handlers/mod.rs`

## Dependencies
- [x] Task 006 (task cleanup)
- [x] Task 007 (attempt cleanup)
- [x] Task 008 (types)

## Effort Estimate
- Size: S
- Hours: 1

## Definition of Done
- [x] Handler implemented
- [x] Route registered
- [x] Code compiles
- [x] Manual test: `POST /api/projects/{id}/unlink-swarm` works
