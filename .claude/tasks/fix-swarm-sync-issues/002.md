---
name: Implement count_orphaned_for_project query
status: completed
created: 2026-01-12T09:52:07Z
updated: 2026-01-12T10:32:00Z
depends_on: [001]
conflicts_with: []
---

# Task: Implement count_orphaned_for_project query

## Description
Implement the `count_orphaned_for_project()` function in `crates/db/src/models/task/sync.rs` that counts tasks with non-NULL `shared_task_id` for a given project.

## Acceptance Criteria
- [x] Function signature matches: `pub async fn count_orphaned_for_project(pool: &SqlitePool, project_id: Uuid) -> Result<i64, sqlx::Error>`
- [x] Query uses compile-time checked `sqlx::query_scalar!` macro
- [x] Query counts tasks WHERE `project_id = $1 AND shared_task_id IS NOT NULL`
- [x] Test from task 001 passes

## Technical Details
- Location: `crates/db/src/models/task/sync.rs` (lines 404-418)
- Return type: `i64` (count of orphaned tasks)
- Use `sqlx::query_scalar!` with proper type annotations

## Dependencies
- [x] Task 001 (test must exist first)

## Effort Estimate
- Size: XS
- Hours: 0.5

## Definition of Done
- [x] Function implemented
- [x] Code compiles without warnings
- [x] Test passes: `cargo test test_count_orphaned_for_project`

## Implementation Notes
- Function was already implemented in Session 1 (Task 001 included both test and implementation)
- Session 2 fixed a compilation error in the sync health handler (replaced `ApiError::InternalServerError` with direct error propagation)
- Test passes successfully
- Code compiles without errors
