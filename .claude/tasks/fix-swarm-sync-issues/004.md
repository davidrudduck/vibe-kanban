---
name: Add sync health handler and route
status: complete
created: 2026-01-12T09:52:07Z
updated: 2026-01-13T06:15:00Z
depends_on: [002, 003]
conflicts_with: []
---

# Task: Add sync health handler and route

## Description
Implement the sync health endpoint that returns project sync status and orphaned task count.

## Acceptance Criteria
- [x] Handler function `get_project_sync_health()` in `crates/server/src/routes/projects/handlers/core.rs` (line 623)
- [x] Handler calls `count_orphaned_for_project()` to get orphaned task count (line 636)
- [x] Handler returns `SyncHealthResponse` with appropriate values (lines 651-657)
- [x] Route registered in `crates/server/src/routes/projects/mod.rs` as `GET /api/projects/:id/sync-health` (line 69)
- [x] Returns 404 if project not found (handled by load_project_middleware)

## Technical Details
- Handler signature: `pub async fn get_project_sync_health(State(deployment): State<DeploymentImpl>, Path(id): Path<Uuid>) -> Result<ResponseJson<ApiResponse<SyncHealthResponse>>, ApiError>`
- Logic: Check if project exists, get `remote_project_id`, count orphaned tasks, build response

## Dependencies
- [x] Task 002 (count_orphaned_for_project)
- [x] Task 003 (SyncHealthResponse type)

## Effort Estimate
- Size: S
- Hours: 1

## Definition of Done
- [x] Handler implemented (already exists from Task 001)
- [x] Route registered (already exists from Task 001)
- [x] Code compiles (verified with cargo check)
- [x] Manual test: `GET /api/projects/{id}/sync-health` returns valid response
  - ✅ Valid project returns 200 with sync health data
  - ✅ Non-existent project returns 404
  - ✅ Response includes: is_linked, remote_project_id, orphaned_task_count, has_sync_issues, issues array

## Implementation Notes
This task was already completed in Task 001 session. The handler and route were implemented together.

## Verification
Tested via curl on backend (port 4000):
- Valid project ID returns: `{"success":true,"data":{"is_linked":true,"remote_project_id":"5fdff50a-5ac8-421e-b6ea-ca2085e08ef2","orphaned_task_count":44,"has_sync_issues":true,"issues":[{"type":"orphaned_tasks","count":44}]}}`
- Invalid project ID returns: HTTP 404

Implementation uses `load_project_middleware` pattern (Extension<Project>) instead of Path(id), which is the established pattern in this codebase.
