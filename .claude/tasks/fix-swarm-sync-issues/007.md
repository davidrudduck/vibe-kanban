---
name: Implement attempt cleanup function
status: complete
created: 2026-01-12T09:52:07Z
updated: 2026-01-13T06:03:00Z
depends_on: []
conflicts_with: []
---

# Task: Implement attempt cleanup function

## Description
Implement `clear_hive_sync_for_project()` function in task_attempt model that clears `hive_synced_at` for all attempts in a project.

## Acceptance Criteria
- [x] Function location: `crates/db/src/models/task_attempt.rs:665`
- [x] Function signature: `pub async fn clear_hive_sync_for_project(pool: &SqlitePool, project_id: Uuid) -> Result<u64, sqlx::Error>`
- [x] Updates attempts: SET `hive_synced_at = NULL`
- [x] Query joins with tasks table to filter by project_id (using FROM clause)
- [x] Returns number of rows affected

## Technical Details
- Join with tasks table: `FROM task_attempts ta JOIN tasks t ON ta.task_id = t.id WHERE t.project_id = $1`
- Use `sqlx::query!` for compile-time checking

## Dependencies
- No dependencies

## Effort Estimate
- Size: S
- Hours: 0.75

## Definition of Done
- [x] Function implemented at `crates/db/src/models/task_attempt.rs:665`
- [x] Code compiles (cargo test passed)
- [x] Test written and passes: `test_clear_hive_sync_for_project`
